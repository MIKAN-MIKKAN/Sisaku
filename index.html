<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>記憶実験</title>
<meta name="viewport" content="width=device-width">
<style>
  textarea { width:100%; height:50px; }
  #loading { color:red; font-weight:bold; }
</style>
</head>
<body>

<h2>記憶実験</h2>
<div id="main"></div>
<div id="loading" style="display:none">通信中…</div>

<script>
const URL = "【GASのURL】";

const QUESTIONS = [
 ["ubiquitous","至る所にある"],
 ["meticulous","細心の注意を払う"],
 ["ambiguous","曖昧な"],
 ["cognitive","認知の"],
 ["inevitable","避けられない"],
 ["arbitrary","恣意的な"],
 ["plausible","もっともらしい"],
 ["coherent","首尾一貫した"],
 ["salient","顕著な"],
 ["implicit","暗黙の"]
];

let index = 0;
let answers = [];
let subject_id;
let start_time;

init();

function init(){
  document.getElementById("main").innerHTML = `
    <input id="sid" placeholder="A01 / B01">
    <button onclick="start()">開始</button>
  `;
}

function start(){
  subject_id = document.getElementById("sid").value;
  if(!/^([AB][0-9]{2})$/.test(subject_id)){
    alert("ID不正");
    return;
  }
  start_time = new Date().toISOString();
  show();
}

function show(){
  const [q,a] = QUESTIONS[index];
  document.getElementById("main").innerHTML = `
    <p>${index+1}/10</p>
    <p><b>${q}</b></p>
    <p>${a}</p>
    <textarea id="ans"></textarea>
    <button onclick="next()">次へ</button>
  `;
}

function next(){
  const input = document.getElementById("ans").value.trim();
  if(input !== QUESTIONS[index][1]){
    alert("正しく書いてください");
    return;
  }
  answers.push(input);
  index++;
  if(index<10) show();
  else finish();
}

async function finish(){
  document.getElementById("loading").style.display="block";

  const res = await fetch(URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      subject_id,
      answers,
      start_time
    })
  });

  const data = await res.json();
  document.getElementById("loading").style.display="none";

  let html = `<h3>得点 ${data.score}/10</h3>`;
  if(data.next_date){
    html += `<p>次回学習日：${new Date(data.next_date).toLocaleDateString()}</p>`;
  }
  document.getElementById("main").innerHTML = html;
}
</script>
</body>
</html>
