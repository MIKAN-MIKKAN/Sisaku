<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>記憶実験</title>
<meta name="viewport" content="width=device-width">
</head>

<body>
<h2>記憶実験</h2>
<div id="main"></div>

<script>
const WEBAPP_URL =
"https://script.google.com/macros/s/AKfycbwg8kL5Pcx82IqaLx8OdRXDm_XZ0xEbdJ1iWZCCzxhhBee99yJlqJjRLEpI2Qk3uTkkRw/exec";

const QUESTIONS = [
  "ubiquitous","meticulous","ambiguous","cognitive","inevitable",
  "arbitrary","plausible","coherent","subsequent","salient",
  "implicit","explicit","robust","tentative","notorious",
  "intrinsic","extrinsic","converge","diverge","heuristic"
];

let subject_id = localStorage.getItem("subject_id");
let index = 0;
let answers = [];

if (!subject_id) {
  document.getElementById("main").innerHTML = `
    <input id="sid" placeholder="S01">
    <button onclick="start()">開始</button>
  `;
} else {
  show();
}

function start() {
  subject_id = document.getElementById("sid").value;
  localStorage.setItem("subject_id", subject_id);
  show();
}

function show() {
  document.getElementById("main").innerHTML = `
    <p>${index+1} / 20</p>
    <p>${QUESTIONS[index]}</p>
    <input id="ans">
    <button onclick="next()">送信</button>
  `;
}

async function next() {
  answers.push(document.getElementById("ans").value);
  index++;

  if (index < QUESTIONS.length) {
    show();
    return;
  }

  // 全問終了 → 一括送信
  await fetch(WEBAPP_URL, {
    method: "POST",
    body: JSON.stringify({
      subject_id: subject_id,
      answers: answers
    })
  });

  document.getElementById("main").innerHTML =
    "<h3>終了しました。ご協力ありがとうございました。</h3>";
}
</script>
</body>
</html>
